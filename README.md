# Queensland Government Form.io custom component library

This repository provides a bundled JS custom component library to form.io builder / form.io renderer / Squiz Matrix form application.

<img src="https://qld-gov-au.github.io/formio/static/media/formio%20custom%20component.5f82e1bf.png" alt="share diagram" width="480" />

## Goals

Following are the goals of this repository.

### Primary

| Goal           | Description                                                                                                                                                                             | Solution                                                                                       |
| -------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------- |
| JS Bundling    | Bundles a single JS file used in Form.io builder [project settings](https://help.form.io/userguide/projects#custom-js-and-css), which also can be attached by any renderer applications | [Webpack](https://webpack.js.org/) + [Babel](https://babeljs.io/)                              |
| Support IE11   | es5+ JS will be used in dev environment, but needs to be compiled in the bundled file                                                                                                   | [Babel polyfill](https://babeljs.io/docs/en/babel-polyfill/)                                   |
| CI/CD          | Needs a automatic pipeline for doc and CDN deployment                                                                                                                                   | [Github Actions](https://github.com/features/actions)                                          |
| CDN deployment | Bundled JS file needs to be delivered by CDN                                                                                                                                            | Separate Bitbucket repository + [Bamboo](https://servicesmadesimpler.govnet.qld.gov.au/bamboo) |

### Secondary

| Goal                     | Description                                                                 | Solution                                                                                                   |
| ------------------------ | --------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------- |
| Development environment  | for local development                                                       | [Storybook](https://storybook.js.org/)                                                                     |
| Documentation deployment | for hosting the doc generated by Storybook                                  | [Github Page](https://pages.github.com/)                                                                   |
| Testable                 | provides testing infrastructure for local testing and CI/CD                 | [Jest](https://jestjs.io/) + [Testing Library](https://testing-library.com/docs/dom-testing-library/intro) |
| Code quality             | for development consistency and reducing merge conflicts due to code format | [esLint](https://eslint.org/) + [Prettier](https://prettier.io/)                                           |

### Optional

| Goal           | Description                                                                                      | Solution                                      |
| -------------- | ------------------------------------------------------------------------------------------------ | --------------------------------------------- |
| Visual testing | Optional because this project focus more on functionality and doesn't involve style modification | [Chromatic](https://www.chromatic.com/)       |
| Typescript     | improve code quality but require more development resources and developer skill                  | [Typescript](https://www.typescriptlang.org/) |

## Development

- Create a feature branch from `main`.
- Install packages with `npm install`.
- Start development environment with `npm run storybook`.
- Create / Modify components in `src/components`.
- Update `src/components/index.js` for new component.
- Lint and test with `npm run validate`.
- Push your branch and create pull request to merge to `develop` branch.

WIP

## Deployment

- `npm run build`
- `npx http-server build`

WIP

## Usage

You can consume this library either in Form.io Builder or Form.io Renderer.

### Form.io platform builder

To use custom components in the Form.io platform builder, please go to the [Project stage settings](https://help.form.io/userguide/projects#custom-js-and-css) and update the `Custom javascript` URL with the CDN URL of this library:

```
https://dev-static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio-qld.min.js
(This is a temporary URL for POC purpose, actual CDN URL still needs to be confirmed in production.)
```

<img src="https://qld-gov-au.github.io/formio/static/media/formioSettings.fbfb01cf.png" alt="share diagram" width="640" />

### Form.io JS renderer or builder

To use custom components in the Form.io JS renderer, please include the script **AFTER** the formio script.
Pleaser refer to [Form.io doc](https://help.form.io/developers/form-renderer#getting-started) for how to initiate your form application in a HTML page.

```html
<script src="https://unpkg.com/formiojs@latest/dist/formio.full.js"></script>
...
<script src="https://dev-static.qgov.net.au/formio-qld/v1/v1.x.x-latest/formio-qld.min.js"></script>
(This is a temporary URL for POC purpose, actual CDN URL still needs to be
confirmed in production.)
```
